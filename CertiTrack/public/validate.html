<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Validation</title>
    <link rel="stylesheet" href="public/assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Raleway:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap">
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <!-- needed for smart contract-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"></script>
    <style>
        body {
            background-color: #eaecec;
        }

        .navbar-nav .nav-link {
            font-size: 1.5rem;
            padding: 0.5rem 0rem;
        }

        #custom-header {
            background: url('assets/img/trust.jpg?t=<%= timestamp %>') no-repeat center center;
            background-size: cover;
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        #custom-header h1 {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
            letter-spacing: 2px;
            /* Increase letter spacing for a futuristic look */
            text-transform: uppercase;
            /* Uppercase text for emphasis */
        }

        #custom-header span {
            font-size: 20px;
            display: block;
            margin-top: 10px;
        }

        .btn,
        .btn-upload {
            background-color: #24285b;
            color: white;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
        }

        .btn-upload {
            display: inline-block;
            /* To match the layout of the button */
            margin-bottom: 8px;
            /* Adjust margin if needed */
        }

        #dataFileLabel {
            background-color: #24285b;
            color: white;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
        }

        .connectButton {
            background-color: #784794;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            color: white;
            font-size: 1.4rem;
            font-family: monospace;
            border-radius: 4px;
        }

        .connectButton:hover {
            background-color: #f6851b;
        }

        .logo {
            width: 40px;
            height: 40px;
            margin-right: 5px;
        }

        #connectionStatus,
        #contractArea,
        #showNFT {
            width: 100%;
            text-align: right;
        }

        .popup-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 900;
        }

        .validateButton {
            background-color: #784794;
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            text-decoration: none;
            border: darkgoldenrod;
            cursor: pointer;
            color: white;
            font-size: 1.3rem;
            font-family: monospace;
            border-radius: 4px;
            margin-left: 10px;
        }

        .validateButton:hover {
            background-color: #f6851b;
        }

        .logo {
            width: 40px;
            height: 40px;
            margin-right: 5px;
        }

        #validateArea,
        #contractArea,
        #noWalletArea {
            width: 100%;
            text-align: left;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand bg-light navigation-clean navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">CertiTrack</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">Home </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="student.html">Student</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="validate.html">Validation</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="admin.html">Admin</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div id="custom-header" class="row">
            <div class="col-12">
                <h1 class="display-6 fw-bold">Trustworthy Credentials Made Easy: <br>
                    NCI Digital Diplomas with CertiTrack</h1>
                <br>
                <br>
                <span></span>
            </div>
        </div>

        <div class="container py-4 py-xl-5">
            <div class="row gy-4 gy-md-0">
                <div class="col-md-6">
                    <div id="placeholderImage">
                        <img class="rounded img-fluid w-100 fit-cover" style="min-height: 300px;"
                            src="https://cdn.corporatefinanceinstitute.com/assets/data-validation.jpeg">
                    </div>
                    <div id="validationDisplay" style="display: none;"></div>
                </div>
                <div class="col-md-6">
                    <div style="max-width: 100%;">
                        <p>With our blockchain-based solution, validating the authenticity of digital credentials
                            becomes seamless and secure.
                            By leveraging our tamper-proof and directly verifiable certificates through secure URL
                            links,
                            you can instantly verify candidates' qualifications with confidence.<br>
                            Say goodbye to time-consuming manual checks and technical complexities.
                            Gain a competitive edge by streamlining your hiring and admissions process, ensuring trust
                            in the qualifications presented.
                            Embrace the future of credentialing and unlock the potential of a hassle-free verification
                            experience with BCdiploma</p>
                        <div class="mb-4 d-flex flex-row align-items-center">
                            <a class="btn btn-primary btn-lg me-2 validateButton" role="button" href="#diplomaTokenInfo"
                                onclick="connectMetamask()">
                                <img class="logo"
                                    src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/MetaMask_Fox.svg/1024px-MetaMask_Fox.svg.png"
                                    alt="MetaMask Logo">Metamask validation
                            </a>
                            <a class="btn btn-primary btn-lg me-2 validateButton" role="button" href="#basicValidate"
                                onclick="TaketoCID()">
                                <img class="logo" src='assets/img/wallet.png' alt="No Wallet">Basic validation
                            </a>
                        </div>

                        <div class="d-flex flex-column align-items-center">
                            <p id="validateArea" class="mb-0"></p>
                            <p id="noWalletArea" class="mb-0"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6 mb-5 bg-white">
                    <!-- Placeholder image for the NFT -->
                    <div id="placeholder">
                        <img class="rounded img-fluid w-100 fit-cover" style="min-height: 300px;"
                            src="https://www.w2globaldata.com/wp-content/uploads/2021/07/kyc-page-image.jpg">
                    </div>
                    <!-- NFT Display (hidden by default) -->
                    <div id="nftDisplay" class="rounded bg-light"
                        style="min-height: 300px; display: none; justify-content: center; align-items: center;">
                        <!-- The NFT image will be displayed here -->
                    </div>
                </div>
                <div id="diplomaTokenInfo" class="col-md-6 mb-5 bg-white">
                    <div class="d-md-flex align-items-md-end align-items-lg-center">
                        <div>
                            <h5 class="fs-3 fw-bold mb-4">Diploma Token Information</h5>
                            <div class="mt-3">
                                <button class="btn btn-primary" onclick="connectContract()">CONNECT TO CONTRACT</button>
                                <p id="contractArea">Status: Not connected to Contract</p>
                            </div>
                            <div class="mb-3">
                                <label for="cidEntry">Enter CID:</label>
                                <input type="text" id="cidEntry">
                            </div>
                            <button type="button" class="btn btn-primary" onclick="findToken()">Find Token</button>
                            <div id="resultArea" class="mt-3">
                                <p id="studentId" class="fw-bold"></p>
                                <p id="timestamp"></p>
                                <p id="metadata"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div id="basicValidate" class="col-md-6 mb-5">
                        <div class="d-md-flex align-items-md-end align-items-lg-center">
                            <div>
                                <h5 class="fs-3 fw-bold mb-4">Diploma Authentication without Crypto-Wallet</h5>
                                <div class="mb-3">
                                    <label for="cidInputBasic" class="form-label">Enter CID:</label>
                                    <input type="text" class="form-control" id="cidInputBasic" required>
                                </div>
                                <button type="button" class="btn btn-primary d-block w-100" id="validateCidBtn">Validate
                                    CID</button>
                                <div id="validationResult"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-5">
                        <div id="placeholder">
                            <img class="rounded img-fluid" style="max-width: 100%; max-height: 300px;"
                                src="https://frontend-bas-ulzahk.vercel.app/assets/static/69b27802856c6191867028436f698ad3.png">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-light footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 text-center text-lg-start my-auto h-100">
                    <ul class="list-inline mb-2">
                        <li class="list-inline-item"><a href="#">About</a></li>
                        <li class="list-inline-item"><span> </span></li>
                        <li class="list-inline-item"><a href="#">Contact</a></li>
                        <li class="list-inline-item"><span> </span></li>
                        <li class="list-inline-item"><a href="#">Terms of &nbsp;Use</a></li>
                        <li class="list-inline-item"><span> </span></li>
                        <li class="list-inline-item"><a href="#">Privacy Policy</a></li>
                    </ul>
                    <p class="text-muted small mb-4 mb-lg-0">© ASzW 2023. All Rights Reserved.</p>
                </div>
                <div class="col-lg-6 text-center text-lg-end my-auto h-100">
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item"><a href="#"><i class="fa fa-facebook fa-2x fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item"><a href="#"><i class="fa fa-twitter fa-2x fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item"><a href="#"><i class="fa fa-instagram fa-2x fa-fw"></i></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script src="public/assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="public/assets/js/bs-init.js"></script>
    <script src="assets/js/startup-modern.js"></script>
    <script>
        let account;

        const connectMetamask = async () => {
            if (window.ethereum !== "undefined") {
                const accounts = await ethereum.request({ method: "eth_requestAccounts" });
                account = accounts[0];

                const tickImageUrl = "https://static-00.iconduck.com/assets.00/success-icon-512x512-qdg1isa0.png";
                const connectionStatusElement = document.getElementById("validateArea");
                connectionStatusElement.innerHTML = `Connected to Wallet <img src="${tickImageUrl}" alt="Tick" width="40" height="40">`;
            }
        };

        const connectContract = async () => {
            const ABI = [
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_owner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_approved",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "Approval",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_owner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_operator",
                            "type": "address"
                        },
                        {
                            "indexed": false,
                            "internalType": "bool",
                            "name": "_approved",
                            "type": "bool"
                        }
                    ],
                    "name": "ApprovalForAll",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "string",
                            "name": "_uri",
                            "type": "string"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "_mintTimestamp",
                            "type": "uint256"
                        }
                    ],
                    "name": "MintEvent",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "previousOwner",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "newOwner",
                            "type": "address"
                        }
                    ],
                    "name": "OwnershipTransferred",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_from",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "Transfer",
                    "type": "event"
                },
                {
                    "anonymous": false,
                    "inputs": [
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_from",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "indexed": true,
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        },
                        {
                            "indexed": false,
                            "internalType": "uint256",
                            "name": "_transferTimestamp",
                            "type": "uint256"
                        }
                    ],
                    "name": "TransferEvent",
                    "type": "event"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_approved",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "approve",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        },
                        {
                            "internalType": "string",
                            "name": "_uri",
                            "type": "string"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_transferTimestamp",
                            "type": "uint256"
                        }
                    ],
                    "name": "mint",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_from",
                            "type": "address"
                        },
                        {
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_from",
                            "type": "address"
                        },
                        {
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        },
                        {
                            "internalType": "bytes",
                            "name": "_data",
                            "type": "bytes"
                        }
                    ],
                    "name": "safeTransferFrom",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_operator",
                            "type": "address"
                        },
                        {
                            "internalType": "bool",
                            "name": "_approved",
                            "type": "bool"
                        }
                    ],
                    "name": "setApprovalForAll",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "transfer",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_from",
                            "type": "address"
                        },
                        {
                            "internalType": "address",
                            "name": "_to",
                            "type": "address"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "transferFrom",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_newOwner",
                            "type": "address"
                        }
                    ],
                    "name": "transferOwnership",
                    "outputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_owner",
                            "type": "address"
                        }
                    ],
                    "name": "balanceOf",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "CANNOT_TRANSFER_TO_ZERO_ADDRESS",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "getApproved",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "getTokenTransferTimestamp",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "_owner",
                            "type": "address"
                        },
                        {
                            "internalType": "address",
                            "name": "_operator",
                            "type": "address"
                        }
                    ],
                    "name": "isApprovedForAll",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "name",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "_name",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "NOT_CURRENT_OWNER",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "owner",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "ownerOf",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "_owner",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "bytes4",
                            "name": "_interfaceID",
                            "type": "bytes4"
                        }
                    ],
                    "name": "supportsInterface",
                    "outputs": [
                        {
                            "internalType": "bool",
                            "name": "",
                            "type": "bool"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [],
                    "name": "symbol",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "_symbol",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_tokenId",
                            "type": "uint256"
                        }
                    ],
                    "name": "tokenURI",
                    "outputs": [
                        {
                            "internalType": "string",
                            "name": "",
                            "type": "string"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function"
                }
            ];
            const Address = "0x27ade3b90a192f3b3969a13c6eae87d03541001a";
            window.web3 = await new Web3(window.ethereum);
            window.contract = await new window.web3.eth.Contract(ABI, Address);

            const tickImage = "https://static-00.iconduck.com/assets.00/success-icon-512x512-qdg1isa0.png";
            const contractConnectElement = document.getElementById("contractArea");
            contractConnectElement.innerHTML = `Connected to Smart Contract <img src="${tickImage}" alt="Tick" width="40" height="40">`;
        }

        const getContractAccount = async () => {
            const data = await window.contract.methods.getAddress().call();
            document.getElementById("contractAccount").innerHTML = `Contract Account: ${data}`;
        }

        // Validate CID button click handler
        async function handleValidateCidButtonClick(event) {
            // Prevent the default form submission behavior
            event.preventDefault();

            // Find the closest "basicValidate" section
            const basicValidateSection = event.target.closest("#basicValidate");

            if (basicValidateSection) {
                // Find the CID input within the specific section
                const cidInput = basicValidateSection.querySelector("#cidInputBasic").value;

                // Make a GET request to the server's /validateCID endpoint
                try {
                    const response = await fetch(`/validateCID?cid=${cidInput}`);
                    const data = await response.json();

                    // Handle the response data as needed
                    const validationResult = document.getElementById("validationResult");
                    if (data.success) {
                        // Success, display the validation response to the user
                        validationResult.innerHTML = `Certificate with CID ${cidInput} is valid for student ID ${data.studentId}`;
                    } else {
                        // Error, display the error message to the user
                        validationResult.innerHTML = `Error: ${data.message}`;
                    }
                } catch (error) {
                    // Error, display the error message to the user
                    const validationResult = document.getElementById("validationResult");
                    validationResult.innerHTML = `Error: ${error.message}`;
                } finally {
                    // Clear the input field after processing is complete
                    cidEntry.value = '';
                }
            }
        }

        // Attach event listeners
        const validateCidBtn = document.getElementById("validateCidBtn");
        validateCidBtn.addEventListener("click", handleValidateCidButtonClick);
        async function findToken() {
            const cid = document.getElementById('cidEntry').value;

            try {
                const response = await fetch(`/validateCID?cid=${cid}`);
                const data = await response.json();

                if (!data.success) {
                    // Handle error when CID is not found
                    document.getElementById('resultArea').innerHTML = '<p>Token not found.</p>';
                    return;
                }

                // Fetch additional NFT information using your existing contract interactions
                const studentId = parseInt(data.studentId);
                const tokenOwner = await window.contract.methods.ownerOf(studentId).call();

                if (tokenOwner.toLowerCase() !== account.toLowerCase()) {
                    // Display a message if the NFT is not associated with the connected MetaMask wallet
                    document.getElementById('nftInfoArea').innerHTML =
                        "<p>This Diploma is not associated with the connected MetaMask wallet!</p><br><p>Please reconnect with the correct wallet, or try a different studentID.</p>";
                } else {
                    // Retrieve NFT information (token URI and transfer timestamp) from the contract
                    const tokenUri = await window.contract.methods.tokenURI(studentId).call({ from: account });
                    const transferTimestamp = await window.contract.methods.getTokenTransferTimestamp(studentId).call();
                    const transferDateTime = new Date(transferTimestamp * 1000);

                    const options = {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                    };

                    const formattedDate = transferDateTime.toLocaleDateString('en-GB', options);

                    // Display the student ID and formatted date
                    document.getElementById('studentId').textContent = `Student ID: ${data.studentId} | Added to Blockchain on: ${formattedDate}`;

                    // Set the content and show the NFTDisplay, hide the placeholder
                    const nftDisplay = document.getElementById("nftDisplay");
                    nftDisplay.innerHTML = `<img src="${tokenUri}" alt="NFT Image" style="max-width: 100%; max-height: 100%;">`;

                    const placeholder = document.getElementById("placeholder");
                    placeholder.style.display = "none";
                    nftDisplay.style.display = "block";
                }
            } catch (error) {
                console.error('Error fetching token data:', error);
                document.getElementById('resultArea').innerHTML = '<p>Error fetching token data.</p>';
            } finally {
            // Clear the input field after processing is complete
            cidInputBasic.value = '';
        }
    }

    </script>
</body>

</html>